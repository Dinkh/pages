"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["vendors-src_menu_List_mjs"],{

/***/ "./src/menu/List.mjs":
/*!***************************!*\
  !*** ./src/menu/List.mjs ***!
  \***************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ List)
/* harmony export */ });
/* harmony import */ var _list_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../list/Base.mjs */ "./src/list/Base.mjs");
/* harmony import */ var _selection_menu_ListModel_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../selection/menu/ListModel.mjs */ "./src/selection/menu/ListModel.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../util/Array.mjs */ "./src/util/Array.mjs");
/* harmony import */ var _Store_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Store.mjs */ "./src/menu/Store.mjs");





/**
 * @class Neo.menu.List
 * @extends Neo.list.Base
 */
class List extends _list_Base_mjs__WEBPACK_IMPORTED_MODULE_0__.default {
    static getConfig() {return {
        /**
         * @member {String} className='Neo.menu.List'
         * @protected
         */
        className: 'Neo.menu.List',
        /**
         * @member {String} ntype='menu-list'
         * @protected
         */
        ntype: 'menu-list',
        /**
         * Read only. We are storing the currently visible subMenu instance.
         * @member {Neo.menu.List|Neo.menu.Panel|null} activeSubMenu=null
         */
        activeSubMenu: null,
        /**
         * @member {String[]} cls=['neo-menu-list','neo-list']
         */
        cls: ['neo-menu-list', 'neo-list'],
        /**
         * True will add 'neo-floating' to the instance cls list.
         * @member {Boolean} floating_=false
         */
        floating_: false,
        /**
         * setTimeout() id after a focus-leave event.
         * @member {Number|null} focusTimeoutId=null
         * @protected
         */
        focusTimeoutId: null,
        /**
         * Optionally pass menu.Store data directly
         * @member {Object[]|null} items_=null
         */
        items_: null,
        /**
         * Internal flag.
         * Sub-menus will bubble of focus changes to the top level.
         * @member {Boolean} menuFocus_=false
         * @protected
         */
        menuFocus_: false,
        /**
         * Internal flag.
         * True for a top level menu, false for sub-menus.
         * @member {Boolean} isRoot=true
         * @protected
         */
        isRoot: true,
        /**
         * Storing the list item index of the parent menu in case it exists.
         * @member {Number} parentIndex=0
         * @protected
         */
        parentIndex: 0,
        /**
         * Storing a reference to the parent menu in case it exists.
         * @member {Neo.menu.List|Neo.menu.Panel|null} parentMenu=null
         * @protected
         */
        parentMenu: null,
        /**
         * Value for the list.Base selectionModel_ config
         * @member {Neo.selection.menu.ListModel} selectionModel=ListModel
         */
        selectionModel: _selection_menu_ListModel_mjs__WEBPACK_IMPORTED_MODULE_1__.default,
        /**
         * Value for the list.Base store_ config
         * @member {Neo.menu.Store} store=Store
         */
        store: _Store_mjs__WEBPACK_IMPORTED_MODULE_3__.default,
        /**
         * The distance in px between a menu and a child menu
         * See: https://github.com/neomjs/neo/issues/2569
         * @member {Number} subMenuGap=0
         */
        subMenuGap: 0,
        /**
         * Storing childMenus by record keyProperty
         * @member {Object} subMenuMap=null
         * @protected
         */
        subMenuMap: null,
        /**
         * We are applying a z-index style which is 1 number higher to each sub-menu
         * @member {Number} zIndex_=100
         */
        zIndex_: 100
    }}

    /**
     * Triggered after the floating config got changed
     * @param {Object[]} value
     * @param {Object[]} oldValue
     * @protected
     */
    afterSetFloating(value, oldValue) {
        let cls = this.cls;

        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__.default[value ? 'add' : 'remove'](cls, 'neo-floating');
        this.cls = cls;
    }

    /**
     * Triggered after the items config got changed
     * @param {Object[]} value
     * @param {Object[]} oldValue
     * @protected
     */
    afterSetItems(value, oldValue) {
        let store = this.store;

        oldValue && store.remove(oldValue);
        value    && store.add(value);
    }

    /**
     * Triggered after the menuFocus config got changed
     * @param {Boolean} value
     * @param {Boolean} oldValue
     * @protected
     */
    afterSetMenuFocus(value, oldValue) {
        if (oldValue !== undefined) {
            let me = this;

            if (me.isRoot) {
                if (!value) {
                    me.focusTimeoutId = setTimeout(() => {
                        me[me.floating ? 'unmount' : 'hideSubMenu']();
                    }, 20);
                } else {
                    clearTimeout(me.focusTimeoutId);
                    me.focusTimeoutId = null;
                }
            } else {
                // bubble the focus change upwards
                me.parentMenu.menuFocus = value;
            }
        }
    }

    /**
     * Triggered after the zIndex config got changed
     * @param {Number} value
     * @param {Number} oldValue
     * @protected
     */
    afterSetZIndex(value, oldValue) {
        this.style = {...this.style, zIndex: value};
    }

    /**
     * Override this method for custom renderers
     * @param {Object} record
     * @param {Number} index
     * @returns {Object|Object[]|String} Either a config object to assign to the item, a vdom cn array or a html string
     */
    createItemContent(record, index) {
        let me     = this,
            id     = record[me.store.keyProperty],
            vdomCn = [{tag: 'span', cls: ['neo-content'], html: record[me.displayField]}];

        if (record.iconCls && record.iconCls !== '') {
            vdomCn.unshift({tag: 'i', cls: ['neo-menu-icon', 'neo-icon', record.iconCls], id: me.getIconId(id)});
        }

        if (me.hasChildren(record)) {
            vdomCn.push({tag: 'i', cls: ['neo-arrow-icon', 'neo-icon', 'fas fa-chevron-right'], id: me.getArrowIconId(id)});
        }

        return vdomCn;
    }

    /**
     *
     */
    destroy(...args) {
        let me            = this,
            activeSubMenu = me.activeSubMenu,
            subMenuMap    = me.subMenuMap;

        me.store.destroy();

        if (activeSubMenu) {
            activeSubMenu.unmount();
        }

        Object.entries(subMenuMap).forEach(([key, value]) => {
            value.destroy();
            subMenuMap[key] = null;
        });

        super.destroy(...args);
    }

    /**
     *
     * @param {Number|String} recordId
     * @returns {String}
     */
    getArrowIconId(recordId) {
        return `${this.id}__arrow_icon__${recordId}`;
    }

    /**
     *
     * @param {Number|String} recordId
     * @returns {String}
     */
    getIconId(recordId) {
        return `${this.id}__icon__${recordId}`;
    }

    /**
     * recordIds can be Numbers, so we do need a prefix
     * @param {Number|String} recordId
     * @returns {String}
     */
    getMenuMapId(recordId) {
        return `menu__${recordId}`;
    }

    /**
     * Checks if a record has items
     * @param {Object} record
     * @returns {Boolean}
     */
    hasChildren(record) {
        return Array.isArray(record.items) && record.items.length > 0;
    }

    /**
     *
     */
    hideSubMenu() {
        let me            = this,
            activeSubMenu = me.activeSubMenu;

        if (activeSubMenu) {
            activeSubMenu.unmount();
            me.activeSubMenu = null;
        }
    }

    /**
     *
     * @param {Object} data
     * @param {Object[]} data.path
     */
    onFocusEnter(data) {
        this.menuFocus = true;
    }

    /**
     *
     * @param {Object} data
     * @param {Object[]} data.oldPath
     */
    onFocusLeave(data) {
        this.menuFocus = false;
    }

    /**
     *
     * @param {String[]} items
     */
    onSelect(items) {
        let me       = this,
            nodeId   = items[0],
            recordId = me.getItemRecordId(nodeId),
            record   = me.store.get(recordId);

        if (me.activeSubMenu !== me.subMenuMap?.[me.getMenuMapId(recordId)]) {
            me.hideSubMenu();

            if (me.hasChildren(record)) {
                me.showSubMenu(nodeId, record);
            }
        }
    }

    /**
     *
     * @param {String} nodeId
     * @param {Object} record
     */
    showSubMenu(nodeId, record) {
        let me           = this,
            store        = me.store,
            recordId     = record[store.keyProperty],
            subMenuMap   = me.subMenuMap || {},
            subMenuMapId = me.getMenuMapId(recordId),
            subMenu      = subMenuMap[subMenuMapId],
            menuStyle, style;

        Neo.main.DomAccess.getBoundingClientRect({
            appName: me.appName,
            id     : nodeId
        }).then(rect => {
            style = {
                left: `${rect.right + me.subMenuGap}px`,
                top : `${rect.top - 1}px` // minus the border
            };

            if (subMenu) {
                menuStyle = subMenu.style;

                Object.assign(menuStyle, style);

                subMenu.setSilent({style: menuStyle});
            } else {
                subMenuMap[subMenuMapId] = subMenu = Neo.create({
                    module     : List,
                    appName    : me.appName,
                    floating   : true,
                    items      : record.items,
                    isRoot     : false,
                    parentId   : Neo.apps[me.appName].mainView.id,
                    parentIndex: store.indexOf(record),
                    parentMenu : me,
                    style      : style,
                    zIndex     : me.zIndex + 1
                });
            }

            me.activeSubMenu = subMenu;
            me.subMenuMap    = subMenuMap;

            subMenu.render(true);
        });
    }

    /**
     *
     */
    unmount() {
        this.selectionModel.deselectAll(true); // silent update
        this.hideSubMenu();

        super.unmount();
    }
}

Neo.applyClassConfig(List);




/***/ }),

/***/ "./src/menu/Model.mjs":
/*!****************************!*\
  !*** ./src/menu/Model.mjs ***!
  \****************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Model)
/* harmony export */ });
/* harmony import */ var _src_data_Model_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../src/data/Model.mjs */ "./src/data/Model.mjs");


/**
 * @class Neo.menu.Model
 * @extends Neo.data.Model
 */
class Model extends _src_data_Model_mjs__WEBPACK_IMPORTED_MODULE_0__.default {
    static getConfig() {return {
        /**
         * @member {String} className='Neo.menu.Model'
         * @protected
         */
        className: 'Neo.menu.Model',
        /**
         * @member {String} keyProperty='id'
         */
        keyProperty: 'id',
        /**
         * @member {Object[]} fields
         */
        fields: [{
            name: 'iconCls',
            type: 'String'
        }, {
            name: 'id',
            type: 'Integer'
        }, {
            name: 'items', // optional
            type: 'Array'
        }, {
            name: 'name',
            type: 'String'
        }]
    }}
}

Neo.applyClassConfig(Model);




/***/ }),

/***/ "./src/menu/Store.mjs":
/*!****************************!*\
  !*** ./src/menu/Store.mjs ***!
  \****************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Store)
/* harmony export */ });
/* harmony import */ var _Model_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Model.mjs */ "./src/menu/Model.mjs");
/* harmony import */ var _src_data_Store_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../src/data/Store.mjs */ "./src/data/Store.mjs");



/**
 * @class Neo.menu.Store
 * @extends Neo.data.Store
 */
class Store extends _src_data_Store_mjs__WEBPACK_IMPORTED_MODULE_1__.default {
    static getConfig() {return {
        /**
         * @member {String} className='Neo.menu.Store'
         * @protected
         */
        className: 'Neo.menu.Store',
        /**
         * @member {Neo.menu.Model} model=Model
         */
        model: _Model_mjs__WEBPACK_IMPORTED_MODULE_0__.default
    }}
}

Neo.applyClassConfig(Store);




/***/ }),

/***/ "./src/selection/menu/ListModel.mjs":
/*!******************************************!*\
  !*** ./src/selection/menu/ListModel.mjs ***!
  \******************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ ListModel)
/* harmony export */ });
/* harmony import */ var _ListModel_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../ListModel.mjs */ "./src/selection/ListModel.mjs");


/**
 * @class Neo.selection.menu.ListModel
 * @extends Neo.selection.ListModel
 */
class ListModel extends _ListModel_mjs__WEBPACK_IMPORTED_MODULE_0__.default {
    static getConfig() {return {
        /**
         * @member {String} className='Neo.selection.menu.ListModel'
         * @protected
         */
        className: 'Neo.selection.menu.ListModel',
        /**
         * @member {String} ntype='selection-menu-listmodel'
         * @protected
         */
        ntype: 'selection-menu-listmodel'
    }}

    /**
     *
     * @param {Object} data
     */
    onKeyDownLeft(data) {
        let view       = this.view,
            parentMenu = view.parentMenu;

        if (parentMenu) {
            view.hideSubMenu();
            view.selectionModel.deselectAll();
            parentMenu.selectionModel.selectAt(view.parentIndex);
        }
    }

    /**
     *
     * @param {Object} data
     */
    onKeyDownRight(data) {
        let activeSubMenu = this.view.activeSubMenu;

        if (activeSubMenu) {
            activeSubMenu.selectionModel.selectAt(0);
        }
    }
}

Neo.applyClassConfig(ListModel);




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTs7QUFFMEI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDdENVO0FBQ2E7O0FBRWpEO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHdEQUFTO0FBQzdCLHdCQUF3QjtBQUN4QjtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGdCQUFnQjtBQUNwQztBQUNBLGVBQWUsK0NBQUs7QUFDcEI7QUFDQTs7QUFFQTs7QUFFMEI7Ozs7Ozs7Ozs7Ozs7Ozs7QUN2Qm1COztBQUU3QztBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixtREFBYTtBQUNyQyx3QkFBd0I7QUFDeEI7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRThCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvLm1qcy8uL3NyYy9tZW51L0xpc3QubWpzIiwid2VicGFjazovL25lby5tanMvLi9zcmMvbWVudS9Nb2RlbC5tanMiLCJ3ZWJwYWNrOi8vbmVvLm1qcy8uL3NyYy9tZW51L1N0b3JlLm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vc3JjL3NlbGVjdGlvbi9tZW51L0xpc3RNb2RlbC5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJhc2VMaXN0ICBmcm9tICcuLi9saXN0L0Jhc2UubWpzJztcbmltcG9ydCBMaXN0TW9kZWwgZnJvbSAnLi4vc2VsZWN0aW9uL21lbnUvTGlzdE1vZGVsLm1qcyc7XG5pbXBvcnQgTmVvQXJyYXkgIGZyb20gJy4uL3V0aWwvQXJyYXkubWpzJztcbmltcG9ydCBTdG9yZSAgICAgZnJvbSAnLi9TdG9yZS5tanMnO1xuXG4vKipcbiAqIEBjbGFzcyBOZW8ubWVudS5MaXN0XG4gKiBAZXh0ZW5kcyBOZW8ubGlzdC5CYXNlXG4gKi9cbmNsYXNzIExpc3QgZXh0ZW5kcyBCYXNlTGlzdCB7XG4gICAgc3RhdGljIGdldENvbmZpZygpIHtyZXR1cm4ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBjbGFzc05hbWU9J05lby5tZW51Lkxpc3QnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ05lby5tZW51Lkxpc3QnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBudHlwZT0nbWVudS1saXN0J1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBudHlwZTogJ21lbnUtbGlzdCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZWFkIG9ubHkuIFdlIGFyZSBzdG9yaW5nIHRoZSBjdXJyZW50bHkgdmlzaWJsZSBzdWJNZW51IGluc3RhbmNlLlxuICAgICAgICAgKiBAbWVtYmVyIHtOZW8ubWVudS5MaXN0fE5lby5tZW51LlBhbmVsfG51bGx9IGFjdGl2ZVN1Yk1lbnU9bnVsbFxuICAgICAgICAgKi9cbiAgICAgICAgYWN0aXZlU3ViTWVudTogbnVsbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ1tdfSBjbHM9WyduZW8tbWVudS1saXN0JywnbmVvLWxpc3QnXVxuICAgICAgICAgKi9cbiAgICAgICAgY2xzOiBbJ25lby1tZW51LWxpc3QnLCAnbmVvLWxpc3QnXSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRydWUgd2lsbCBhZGQgJ25lby1mbG9hdGluZycgdG8gdGhlIGluc3RhbmNlIGNscyBsaXN0LlxuICAgICAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBmbG9hdGluZ189ZmFsc2VcbiAgICAgICAgICovXG4gICAgICAgIGZsb2F0aW5nXzogZmFsc2UsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBzZXRUaW1lb3V0KCkgaWQgYWZ0ZXIgYSBmb2N1cy1sZWF2ZSBldmVudC5cbiAgICAgICAgICogQG1lbWJlciB7TnVtYmVyfG51bGx9IGZvY3VzVGltZW91dElkPW51bGxcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgZm9jdXNUaW1lb3V0SWQ6IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPcHRpb25hbGx5IHBhc3MgbWVudS5TdG9yZSBkYXRhIGRpcmVjdGx5XG4gICAgICAgICAqIEBtZW1iZXIge09iamVjdFtdfG51bGx9IGl0ZW1zXz1udWxsXG4gICAgICAgICAqL1xuICAgICAgICBpdGVtc186IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbnRlcm5hbCBmbGFnLlxuICAgICAgICAgKiBTdWItbWVudXMgd2lsbCBidWJibGUgb2YgZm9jdXMgY2hhbmdlcyB0byB0aGUgdG9wIGxldmVsLlxuICAgICAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBtZW51Rm9jdXNfPWZhbHNlXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIG1lbnVGb2N1c186IGZhbHNlLFxuICAgICAgICAvKipcbiAgICAgICAgICogSW50ZXJuYWwgZmxhZy5cbiAgICAgICAgICogVHJ1ZSBmb3IgYSB0b3AgbGV2ZWwgbWVudSwgZmFsc2UgZm9yIHN1Yi1tZW51cy5cbiAgICAgICAgICogQG1lbWJlciB7Qm9vbGVhbn0gaXNSb290PXRydWVcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgaXNSb290OiB0cnVlLFxuICAgICAgICAvKipcbiAgICAgICAgICogU3RvcmluZyB0aGUgbGlzdCBpdGVtIGluZGV4IG9mIHRoZSBwYXJlbnQgbWVudSBpbiBjYXNlIGl0IGV4aXN0cy5cbiAgICAgICAgICogQG1lbWJlciB7TnVtYmVyfSBwYXJlbnRJbmRleD0wXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIHBhcmVudEluZGV4OiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogU3RvcmluZyBhIHJlZmVyZW5jZSB0byB0aGUgcGFyZW50IG1lbnUgaW4gY2FzZSBpdCBleGlzdHMuXG4gICAgICAgICAqIEBtZW1iZXIge05lby5tZW51Lkxpc3R8TmVvLm1lbnUuUGFuZWx8bnVsbH0gcGFyZW50TWVudT1udWxsXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIHBhcmVudE1lbnU6IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBWYWx1ZSBmb3IgdGhlIGxpc3QuQmFzZSBzZWxlY3Rpb25Nb2RlbF8gY29uZmlnXG4gICAgICAgICAqIEBtZW1iZXIge05lby5zZWxlY3Rpb24ubWVudS5MaXN0TW9kZWx9IHNlbGVjdGlvbk1vZGVsPUxpc3RNb2RlbFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZWN0aW9uTW9kZWw6IExpc3RNb2RlbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFZhbHVlIGZvciB0aGUgbGlzdC5CYXNlIHN0b3JlXyBjb25maWdcbiAgICAgICAgICogQG1lbWJlciB7TmVvLm1lbnUuU3RvcmV9IHN0b3JlPVN0b3JlXG4gICAgICAgICAqL1xuICAgICAgICBzdG9yZTogU3RvcmUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZGlzdGFuY2UgaW4gcHggYmV0d2VlbiBhIG1lbnUgYW5kIGEgY2hpbGQgbWVudVxuICAgICAgICAgKiBTZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9uZW9tanMvbmVvL2lzc3Vlcy8yNTY5XG4gICAgICAgICAqIEBtZW1iZXIge051bWJlcn0gc3ViTWVudUdhcD0wXG4gICAgICAgICAqL1xuICAgICAgICBzdWJNZW51R2FwOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogU3RvcmluZyBjaGlsZE1lbnVzIGJ5IHJlY29yZCBrZXlQcm9wZXJ0eVxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3R9IHN1Yk1lbnVNYXA9bnVsbFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBzdWJNZW51TWFwOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogV2UgYXJlIGFwcGx5aW5nIGEgei1pbmRleCBzdHlsZSB3aGljaCBpcyAxIG51bWJlciBoaWdoZXIgdG8gZWFjaCBzdWItbWVudVxuICAgICAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9IHpJbmRleF89MTAwXG4gICAgICAgICAqL1xuICAgICAgICB6SW5kZXhfOiAxMDBcbiAgICB9fVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSBmbG9hdGluZyBjb25maWcgZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge09iamVjdFtdfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0W119IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0RmxvYXRpbmcodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIGxldCBjbHMgPSB0aGlzLmNscztcblxuICAgICAgICBOZW9BcnJheVt2YWx1ZSA/ICdhZGQnIDogJ3JlbW92ZSddKGNscywgJ25lby1mbG9hdGluZycpO1xuICAgICAgICB0aGlzLmNscyA9IGNscztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgdGhlIGl0ZW1zIGNvbmZpZyBnb3QgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7T2JqZWN0W119IHZhbHVlXG4gICAgICogQHBhcmFtIHtPYmplY3RbXX0gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYWZ0ZXJTZXRJdGVtcyh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgbGV0IHN0b3JlID0gdGhpcy5zdG9yZTtcblxuICAgICAgICBvbGRWYWx1ZSAmJiBzdG9yZS5yZW1vdmUob2xkVmFsdWUpO1xuICAgICAgICB2YWx1ZSAgICAmJiBzdG9yZS5hZGQodmFsdWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBhZnRlciB0aGUgbWVudUZvY3VzIGNvbmZpZyBnb3QgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0TWVudUZvY3VzKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBpZiAob2xkVmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICAgICAgaWYgKG1lLmlzUm9vdCkge1xuICAgICAgICAgICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgbWUuZm9jdXNUaW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lW21lLmZsb2F0aW5nID8gJ3VubW91bnQnIDogJ2hpZGVTdWJNZW51J10oKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMjApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChtZS5mb2N1c1RpbWVvdXRJZCk7XG4gICAgICAgICAgICAgICAgICAgIG1lLmZvY3VzVGltZW91dElkID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIGJ1YmJsZSB0aGUgZm9jdXMgY2hhbmdlIHVwd2FyZHNcbiAgICAgICAgICAgICAgICBtZS5wYXJlbnRNZW51Lm1lbnVGb2N1cyA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSB6SW5kZXggY29uZmlnIGdvdCBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHZhbHVlXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0WkluZGV4KHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICB0aGlzLnN0eWxlID0gey4uLnRoaXMuc3R5bGUsIHpJbmRleDogdmFsdWV9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE92ZXJyaWRlIHRoaXMgbWV0aG9kIGZvciBjdXN0b20gcmVuZGVyZXJzXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlY29yZFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleFxuICAgICAqIEByZXR1cm5zIHtPYmplY3R8T2JqZWN0W118U3RyaW5nfSBFaXRoZXIgYSBjb25maWcgb2JqZWN0IHRvIGFzc2lnbiB0byB0aGUgaXRlbSwgYSB2ZG9tIGNuIGFycmF5IG9yIGEgaHRtbCBzdHJpbmdcbiAgICAgKi9cbiAgICBjcmVhdGVJdGVtQ29udGVudChyZWNvcmQsIGluZGV4KSB7XG4gICAgICAgIGxldCBtZSAgICAgPSB0aGlzLFxuICAgICAgICAgICAgaWQgICAgID0gcmVjb3JkW21lLnN0b3JlLmtleVByb3BlcnR5XSxcbiAgICAgICAgICAgIHZkb21DbiA9IFt7dGFnOiAnc3BhbicsIGNsczogWyduZW8tY29udGVudCddLCBodG1sOiByZWNvcmRbbWUuZGlzcGxheUZpZWxkXX1dO1xuXG4gICAgICAgIGlmIChyZWNvcmQuaWNvbkNscyAmJiByZWNvcmQuaWNvbkNscyAhPT0gJycpIHtcbiAgICAgICAgICAgIHZkb21Dbi51bnNoaWZ0KHt0YWc6ICdpJywgY2xzOiBbJ25lby1tZW51LWljb24nLCAnbmVvLWljb24nLCByZWNvcmQuaWNvbkNsc10sIGlkOiBtZS5nZXRJY29uSWQoaWQpfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobWUuaGFzQ2hpbGRyZW4ocmVjb3JkKSkge1xuICAgICAgICAgICAgdmRvbUNuLnB1c2goe3RhZzogJ2knLCBjbHM6IFsnbmVvLWFycm93LWljb24nLCAnbmVvLWljb24nLCAnZmFzIGZhLWNoZXZyb24tcmlnaHQnXSwgaWQ6IG1lLmdldEFycm93SWNvbklkKGlkKX0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZkb21DbjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIGRlc3Ryb3koLi4uYXJncykge1xuICAgICAgICBsZXQgbWUgICAgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBhY3RpdmVTdWJNZW51ID0gbWUuYWN0aXZlU3ViTWVudSxcbiAgICAgICAgICAgIHN1Yk1lbnVNYXAgICAgPSBtZS5zdWJNZW51TWFwO1xuXG4gICAgICAgIG1lLnN0b3JlLmRlc3Ryb3koKTtcblxuICAgICAgICBpZiAoYWN0aXZlU3ViTWVudSkge1xuICAgICAgICAgICAgYWN0aXZlU3ViTWVudS51bm1vdW50KCk7XG4gICAgICAgIH1cblxuICAgICAgICBPYmplY3QuZW50cmllcyhzdWJNZW51TWFwKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgICAgIHZhbHVlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHN1Yk1lbnVNYXBba2V5XSA9IG51bGw7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHN1cGVyLmRlc3Ryb3koLi4uYXJncyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge051bWJlcnxTdHJpbmd9IHJlY29yZElkXG4gICAgICogQHJldHVybnMge1N0cmluZ31cbiAgICAgKi9cbiAgICBnZXRBcnJvd0ljb25JZChyZWNvcmRJZCkge1xuICAgICAgICByZXR1cm4gYCR7dGhpcy5pZH1fX2Fycm93X2ljb25fXyR7cmVjb3JkSWR9YDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfFN0cmluZ30gcmVjb3JkSWRcbiAgICAgKiBAcmV0dXJucyB7U3RyaW5nfVxuICAgICAqL1xuICAgIGdldEljb25JZChyZWNvcmRJZCkge1xuICAgICAgICByZXR1cm4gYCR7dGhpcy5pZH1fX2ljb25fXyR7cmVjb3JkSWR9YDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiByZWNvcmRJZHMgY2FuIGJlIE51bWJlcnMsIHNvIHdlIGRvIG5lZWQgYSBwcmVmaXhcbiAgICAgKiBAcGFyYW0ge051bWJlcnxTdHJpbmd9IHJlY29yZElkXG4gICAgICogQHJldHVybnMge1N0cmluZ31cbiAgICAgKi9cbiAgICBnZXRNZW51TWFwSWQocmVjb3JkSWQpIHtcbiAgICAgICAgcmV0dXJuIGBtZW51X18ke3JlY29yZElkfWA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGEgcmVjb3JkIGhhcyBpdGVtc1xuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZWNvcmRcbiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICAgKi9cbiAgICBoYXNDaGlsZHJlbihyZWNvcmQpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkocmVjb3JkLml0ZW1zKSAmJiByZWNvcmQuaXRlbXMubGVuZ3RoID4gMDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIGhpZGVTdWJNZW51KCkge1xuICAgICAgICBsZXQgbWUgICAgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBhY3RpdmVTdWJNZW51ID0gbWUuYWN0aXZlU3ViTWVudTtcblxuICAgICAgICBpZiAoYWN0aXZlU3ViTWVudSkge1xuICAgICAgICAgICAgYWN0aXZlU3ViTWVudS51bm1vdW50KCk7XG4gICAgICAgICAgICBtZS5hY3RpdmVTdWJNZW51ID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBkYXRhLnBhdGhcbiAgICAgKi9cbiAgICBvbkZvY3VzRW50ZXIoZGF0YSkge1xuICAgICAgICB0aGlzLm1lbnVGb2N1cyA9IHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqIEBwYXJhbSB7T2JqZWN0W119IGRhdGEub2xkUGF0aFxuICAgICAqL1xuICAgIG9uRm9jdXNMZWF2ZShkYXRhKSB7XG4gICAgICAgIHRoaXMubWVudUZvY3VzID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ1tdfSBpdGVtc1xuICAgICAqL1xuICAgIG9uU2VsZWN0KGl0ZW1zKSB7XG4gICAgICAgIGxldCBtZSAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBub2RlSWQgICA9IGl0ZW1zWzBdLFxuICAgICAgICAgICAgcmVjb3JkSWQgPSBtZS5nZXRJdGVtUmVjb3JkSWQobm9kZUlkKSxcbiAgICAgICAgICAgIHJlY29yZCAgID0gbWUuc3RvcmUuZ2V0KHJlY29yZElkKTtcblxuICAgICAgICBpZiAobWUuYWN0aXZlU3ViTWVudSAhPT0gbWUuc3ViTWVudU1hcD8uW21lLmdldE1lbnVNYXBJZChyZWNvcmRJZCldKSB7XG4gICAgICAgICAgICBtZS5oaWRlU3ViTWVudSgpO1xuXG4gICAgICAgICAgICBpZiAobWUuaGFzQ2hpbGRyZW4ocmVjb3JkKSkge1xuICAgICAgICAgICAgICAgIG1lLnNob3dTdWJNZW51KG5vZGVJZCwgcmVjb3JkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG5vZGVJZFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZWNvcmRcbiAgICAgKi9cbiAgICBzaG93U3ViTWVudShub2RlSWQsIHJlY29yZCkge1xuICAgICAgICBsZXQgbWUgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIHN0b3JlICAgICAgICA9IG1lLnN0b3JlLFxuICAgICAgICAgICAgcmVjb3JkSWQgICAgID0gcmVjb3JkW3N0b3JlLmtleVByb3BlcnR5XSxcbiAgICAgICAgICAgIHN1Yk1lbnVNYXAgICA9IG1lLnN1Yk1lbnVNYXAgfHwge30sXG4gICAgICAgICAgICBzdWJNZW51TWFwSWQgPSBtZS5nZXRNZW51TWFwSWQocmVjb3JkSWQpLFxuICAgICAgICAgICAgc3ViTWVudSAgICAgID0gc3ViTWVudU1hcFtzdWJNZW51TWFwSWRdLFxuICAgICAgICAgICAgbWVudVN0eWxlLCBzdHlsZTtcblxuICAgICAgICBOZW8ubWFpbi5Eb21BY2Nlc3MuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KHtcbiAgICAgICAgICAgIGFwcE5hbWU6IG1lLmFwcE5hbWUsXG4gICAgICAgICAgICBpZCAgICAgOiBub2RlSWRcbiAgICAgICAgfSkudGhlbihyZWN0ID0+IHtcbiAgICAgICAgICAgIHN0eWxlID0ge1xuICAgICAgICAgICAgICAgIGxlZnQ6IGAke3JlY3QucmlnaHQgKyBtZS5zdWJNZW51R2FwfXB4YCxcbiAgICAgICAgICAgICAgICB0b3AgOiBgJHtyZWN0LnRvcCAtIDF9cHhgIC8vIG1pbnVzIHRoZSBib3JkZXJcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChzdWJNZW51KSB7XG4gICAgICAgICAgICAgICAgbWVudVN0eWxlID0gc3ViTWVudS5zdHlsZTtcblxuICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24obWVudVN0eWxlLCBzdHlsZSk7XG5cbiAgICAgICAgICAgICAgICBzdWJNZW51LnNldFNpbGVudCh7c3R5bGU6IG1lbnVTdHlsZX0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzdWJNZW51TWFwW3N1Yk1lbnVNYXBJZF0gPSBzdWJNZW51ID0gTmVvLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZSAgICAgOiBMaXN0LFxuICAgICAgICAgICAgICAgICAgICBhcHBOYW1lICAgIDogbWUuYXBwTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZmxvYXRpbmcgICA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zICAgICAgOiByZWNvcmQuaXRlbXMsXG4gICAgICAgICAgICAgICAgICAgIGlzUm9vdCAgICAgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50SWQgICA6IE5lby5hcHBzW21lLmFwcE5hbWVdLm1haW5WaWV3LmlkLFxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRJbmRleDogc3RvcmUuaW5kZXhPZihyZWNvcmQpLFxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRNZW51IDogbWUsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlICAgICAgOiBzdHlsZSxcbiAgICAgICAgICAgICAgICAgICAgekluZGV4ICAgICA6IG1lLnpJbmRleCArIDFcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbWUuYWN0aXZlU3ViTWVudSA9IHN1Yk1lbnU7XG4gICAgICAgICAgICBtZS5zdWJNZW51TWFwICAgID0gc3ViTWVudU1hcDtcblxuICAgICAgICAgICAgc3ViTWVudS5yZW5kZXIodHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgdW5tb3VudCgpIHtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25Nb2RlbC5kZXNlbGVjdEFsbCh0cnVlKTsgLy8gc2lsZW50IHVwZGF0ZVxuICAgICAgICB0aGlzLmhpZGVTdWJNZW51KCk7XG5cbiAgICAgICAgc3VwZXIudW5tb3VudCgpO1xuICAgIH1cbn1cblxuTmVvLmFwcGx5Q2xhc3NDb25maWcoTGlzdCk7XG5cbmV4cG9ydCB7TGlzdCBhcyBkZWZhdWx0fTtcbiIsImltcG9ydCBCYXNlTW9kZWwgZnJvbSAnLi4vLi4vc3JjL2RhdGEvTW9kZWwubWpzJztcblxuLyoqXG4gKiBAY2xhc3MgTmVvLm1lbnUuTW9kZWxcbiAqIEBleHRlbmRzIE5lby5kYXRhLk1vZGVsXG4gKi9cbmNsYXNzIE1vZGVsIGV4dGVuZHMgQmFzZU1vZGVsIHtcbiAgICBzdGF0aWMgZ2V0Q29uZmlnKCkge3JldHVybiB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTmVvLm1lbnUuTW9kZWwnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ05lby5tZW51Lk1vZGVsJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30ga2V5UHJvcGVydHk9J2lkJ1xuICAgICAgICAgKi9cbiAgICAgICAga2V5UHJvcGVydHk6ICdpZCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3RbXX0gZmllbGRzXG4gICAgICAgICAqL1xuICAgICAgICBmaWVsZHM6IFt7XG4gICAgICAgICAgICBuYW1lOiAnaWNvbkNscycsXG4gICAgICAgICAgICB0eXBlOiAnU3RyaW5nJ1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiAnaWQnLFxuICAgICAgICAgICAgdHlwZTogJ0ludGVnZXInXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICdpdGVtcycsIC8vIG9wdGlvbmFsXG4gICAgICAgICAgICB0eXBlOiAnQXJyYXknXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICduYW1lJyxcbiAgICAgICAgICAgIHR5cGU6ICdTdHJpbmcnXG4gICAgICAgIH1dXG4gICAgfX1cbn1cblxuTmVvLmFwcGx5Q2xhc3NDb25maWcoTW9kZWwpO1xuXG5leHBvcnQge01vZGVsIGFzIGRlZmF1bHR9O1xuIiwiaW1wb3J0IE1vZGVsICAgICBmcm9tICcuL01vZGVsLm1qcyc7XG5pbXBvcnQgQmFzZVN0b3JlIGZyb20gJy4uLy4uL3NyYy9kYXRhL1N0b3JlLm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIE5lby5tZW51LlN0b3JlXG4gKiBAZXh0ZW5kcyBOZW8uZGF0YS5TdG9yZVxuICovXG5jbGFzcyBTdG9yZSBleHRlbmRzIEJhc2VTdG9yZSB7XG4gICAgc3RhdGljIGdldENvbmZpZygpIHtyZXR1cm4ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBjbGFzc05hbWU9J05lby5tZW51LlN0b3JlJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdOZW8ubWVudS5TdG9yZScsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtOZW8ubWVudS5Nb2RlbH0gbW9kZWw9TW9kZWxcbiAgICAgICAgICovXG4gICAgICAgIG1vZGVsOiBNb2RlbFxuICAgIH19XG59XG5cbk5lby5hcHBseUNsYXNzQ29uZmlnKFN0b3JlKTtcblxuZXhwb3J0IHtTdG9yZSBhcyBkZWZhdWx0fTtcbiIsImltcG9ydCBCYXNlTGlzdE1vZGVsIGZyb20gJy4uL0xpc3RNb2RlbC5tanMnO1xuXG4vKipcbiAqIEBjbGFzcyBOZW8uc2VsZWN0aW9uLm1lbnUuTGlzdE1vZGVsXG4gKiBAZXh0ZW5kcyBOZW8uc2VsZWN0aW9uLkxpc3RNb2RlbFxuICovXG5jbGFzcyBMaXN0TW9kZWwgZXh0ZW5kcyBCYXNlTGlzdE1vZGVsIHtcbiAgICBzdGF0aWMgZ2V0Q29uZmlnKCkge3JldHVybiB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTmVvLnNlbGVjdGlvbi5tZW51Lkxpc3RNb2RlbCdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgY2xhc3NOYW1lOiAnTmVvLnNlbGVjdGlvbi5tZW51Lkxpc3RNb2RlbCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IG50eXBlPSdzZWxlY3Rpb24tbWVudS1saXN0bW9kZWwnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIG50eXBlOiAnc2VsZWN0aW9uLW1lbnUtbGlzdG1vZGVsJ1xuICAgIH19XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICovXG4gICAgb25LZXlEb3duTGVmdChkYXRhKSB7XG4gICAgICAgIGxldCB2aWV3ICAgICAgID0gdGhpcy52aWV3LFxuICAgICAgICAgICAgcGFyZW50TWVudSA9IHZpZXcucGFyZW50TWVudTtcblxuICAgICAgICBpZiAocGFyZW50TWVudSkge1xuICAgICAgICAgICAgdmlldy5oaWRlU3ViTWVudSgpO1xuICAgICAgICAgICAgdmlldy5zZWxlY3Rpb25Nb2RlbC5kZXNlbGVjdEFsbCgpO1xuICAgICAgICAgICAgcGFyZW50TWVudS5zZWxlY3Rpb25Nb2RlbC5zZWxlY3RBdCh2aWV3LnBhcmVudEluZGV4KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKi9cbiAgICBvbktleURvd25SaWdodChkYXRhKSB7XG4gICAgICAgIGxldCBhY3RpdmVTdWJNZW51ID0gdGhpcy52aWV3LmFjdGl2ZVN1Yk1lbnU7XG5cbiAgICAgICAgaWYgKGFjdGl2ZVN1Yk1lbnUpIHtcbiAgICAgICAgICAgIGFjdGl2ZVN1Yk1lbnUuc2VsZWN0aW9uTW9kZWwuc2VsZWN0QXQoMCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbk5lby5hcHBseUNsYXNzQ29uZmlnKExpc3RNb2RlbCk7XG5cbmV4cG9ydCB7TGlzdE1vZGVsIGFzIGRlZmF1bHR9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9