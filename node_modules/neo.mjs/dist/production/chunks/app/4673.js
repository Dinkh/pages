(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[4673],{1671:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>c});var n=o(9132),a=o(6076),r=o(3501),l=o(524);const d=new Date;d.getDate(),d.getMonth(),d.getFullYear();class c extends n.Z{static getConfig(){return{className:"Neo.calendar.view.month.Component",ntype:"calendar-view-monthcomponent",bind:{calendarStore:"stores.calendars",currentDate:e=>e.currentDate,eventBorder:e=>e.events.border,eventStore:"stores.events",showWeekends:e=>e.showWeekends},calendarStore_:null,cls:["neo-calendar-monthcomponent"],currentDate_:null,dayNameFormat_:"short",eventBorder_:null,eventStore_:null,headerHeight:null,intlFormat_day:null,intlFormat_month:null,intlFormat_time:null,isScrolling:!1,locale_:Neo.config.locale,monthNameFormat_:"short",owner:null,scrollTaskId:null,showWeekends_:!0,timeFormat_:{hour:"2-digit",minute:"2-digit"},useScrollBoxShadows_:!0,vdom:{cn:[{cls:["neo-days-header"],cn:[{cls:["neo-static-header"],style:{},cn:[{tag:"span",cls:["neo-month-name"],flag:"month-name"},{vtype:"text"}]}]},{cls:["neo-c-m-scrollcontainer"]}]},weekStartDay_:0}}constructor(e){super(e);let t=this,o=t.domListeners;o.push({dblclick:t.onEventDoubleClick,delegate:"neo-event",scope:t},{wheel:t.onWheel,scope:t}),t.domListeners=o,t.calendarStore.getCount()>0&&t.eventStore.getCount()>0&&t.createContent(!0),t.updateHeader(!0)}afterSetCalendarStore(e,t){let o=this;t&&t.un({load:o.onCalendarStoreLoad,recordChange:o.onCalendarStoreRecordChange,scope:o}),e&&e.on({load:o.onCalendarStoreLoad,recordChange:o.onCalendarStoreRecordChange,scope:o})}afterSetCurrentDate(e,t){if(void 0!==t){let e=this;e.createContent(!0),e.updateHeader(),e.afterSetMounted(!0,!1)}}afterSetDayNameFormat(e,t){let o=this;o.intlFormat_day=new Intl.DateTimeFormat(o.locale,{weekday:e}),void 0!==t&&o.updateHeader()}afterSetEventBorder(e,t){let o=this.cls;t&&r.Z.remove(o,`neo-event-border-${t}`),e&&r.Z.add(o,`neo-event-border-${e}`),this.cls=o}afterSetEventStore(e,t){let o=this;t&&t.un("load",o.onEventStoreLoad,o),e&&e.on("load",o.onEventStoreLoad,o)}afterSetLocale(e,t){if(void 0!==t){let t=this;t.intlFormat_day=new Intl.DateTimeFormat(e,{weekday:t.dayNameFormat}),t.intlFormat_month=new Intl.DateTimeFormat(e,{month:t.monthNameFormat}),t.intlFormat_time=new Intl.DateTimeFormat(e,t.timeFormat),t.updateMonthNames(!0),t.updateHeader()}}afterSetMonthNameFormat(e,t){let o=this;o.intlFormat_month=new Intl.DateTimeFormat(o.locale,{month:e}),void 0!==t&&o.updateMonthNames()}afterSetMounted(e,t){e&&setTimeout((()=>{let e=this;Neo.main.DomAccess.getBoundingClientRect({id:[e.vdom.cn[1].id,e.vdom.cn[0].id]}).then((t=>{e.headerHeight=t[1].height,Neo.main.DomAccess.scrollTo({direction:"top",id:e.vdom.cn[1].id,value:t[0].height-t[1].height})}))}),20)}afterSetShowWeekends(e,t){if(void 0!==t){let t,o,n=this;n.vdom.cn[1].cn.forEach((n=>{if(n.flag)for(t=0;t<7;t++)o=n.cn[t],o.cls.includes("neo-weekend")&&(e?delete o.removeDom:o.removeDom=!0)})),n.updateHeader()}}afterSetTimeFormat(e,t){this.intlFormat_time=new Intl.DateTimeFormat(this.locale,e)}afterSetUseScrollBoxShadows(e,t){let o=this,n=o.vdom;r.Z[e?"add":"remove"](o.vdom.cn[1].cls,"neo-scroll-shadows"),o.vdom=n}afterSetWeekStartDay(e,t){void 0!==t&&(this.createContent(!0),this.updateHeader())}beforeSetDayNameFormat(e,t){return this.beforeSetEnumValue(e,t,"dayNameFormat",a.Z.prototype.dayNameFormats)}beforeSetMonthNameFormat(e,t){return this.beforeSetEnumValue(e,t,"monthNameFormat",a.Z.prototype.monthNameFormats)}createContent(e=!1){let t,o,n=this,r=n.currentDate,l=n.vdom,d=0;for(l.cn[1].cn=[],t=a.Z.getFirstDayOffset(r,n.weekStartDay),r.setDate(1-t),r.setDate(r.getDate()-42);d<18;d++)o=n.createWeek(a.Z.clone(r)),o.header&&l.cn[1].cn.push(o.header),l.cn[1].cn.push(o.row),r.setDate(r.getDate()+7);n[e?"_vdom":"vdom"]=l}createWeek(e){let t,o,n,r,l,d,c,s=this,m=0,i=s.calendarStore,h=s.eventStore,u=null,g=a.Z.convertToyyyymmdd(e);for(d={flag:g,cls:["neo-week"],cn:[],id:`${s.id}__week__${g}`};m<7;m++)o=e.getDate(),g=a.Z.convertToyyyymmdd(e),1===o&&(d.flag=g,u={cls:["neo-month-header"],cn:[{cls:["neo-month-header-content"],cn:[{tag:"span",cls:["neo-month-name"],flag:"month-name",html:s.intlFormat_month.format(e)},{vtype:"text",html:` ${e.getFullYear()}`}]}]}),n={cls:["neo-day"],id:`${s.id}__day__${g}`,cn:[{cls:["neo-day-number"],html:o,id:`${s.id}__day_number__${g}`}]},c=e.getDay(),0!==c&&6!==c||(n.cls.push("neo-weekend"),s.showWeekends||(n.removeDom=!0)),n.removeDom||(r=h.getDayRecords(e),r.forEach((e=>{l=e[h.keyProperty],t=i.get(e.calendarId),t.active&&n.cn.push({cls:["neo-event",`neo-${t.color}`],flag:l,id:s.id+"__"+l,tabIndex:-1,cn:[{cls:["neo-event-title"],html:e.title,id:s.id+"__title__"+l},{cls:["neo-event-time"],html:s.intlFormat_time.format(e.startDate),id:s.id+"__time__"+l}]})}))),d.cn.push(n),e.setDate(e.getDate()+1);return{header:u,row:d}}onCalendarStoreLoad(e){this.eventStore.getCount()>0&&this.createContent()}onCalendarStoreRecordChange(e){this.createContent()}onEventDoubleClick(e){if(this.data.events.enableEdit){let t=this,o=t.owner.editEventContainer,n=e.path[0],a=e.path[2],r=e.path[3],d=l.Z.findVdomChild(t.vdom,n.id).vdom,c=t.eventStore.get(d.flag),s=o.style;Object.assign(s,{left:n.rect.right-a.rect.left+15+"px",top:n.rect.top-r.rect.top+r.scrollTop-12+"px"}),o.setSilent({currentView:t,parentId:e.path[1].id,record:c,style:s}),o.render(!0)}}onEventStoreLoad(e){this.calendarStore.getCount()>0&&this.createContent()}onFocusChange(e){let t=e.oldPath,o=e.path;t&&t[0].cls&&t[0].cls.includes("neo-event")&&Neo.applyDeltas(this.appName,{id:t[0].id,cls:{remove:["neo-focus"]}}),o&&o[0].cls&&o[0].cls.includes("neo-event")&&Neo.applyDeltas(this.appName,{id:o[0].id,cls:{add:["neo-focus"]}})}onWheel(e){if(Math.abs(e.deltaY)>Math.abs(e.deltaX)){let t,o,n,l=this,d=l.vdom,c=d.cn[1],s=0;if(e.deltaY>0&&Math.round(e.scrollTop/(e.clientHeight-l.headerHeight)*6)>11){for(t=new Date(c.cn[c.cn.length-1].flag),t.setDate(t.getDate()-(t.getDay()-l.weekStartDay));s<6;s++)c.cn[1].cls.includes("neo-month-header")&&c.cn.splice(1,1),c.cn.shift(),t.setDate(t.getDate()+7),n=l.createWeek(a.Z.clone(t)),n.header&&c.cn.push(n.header),c.cn.push(n.row);l.vdom=d}else if(e.deltaY<0&&Math.round(e.scrollTop/(e.clientHeight-l.headerHeight)*6)<1){for(t=c.cn[0].flag?new Date(c.cn[0].flag):new Date(c.cn[1].flag),t.setDate(t.getDate()-(t.getDay()-l.weekStartDay));s<6;s++)o=c.cn.length,c.cn[o-2].cls.includes("neo-month-header")&&c.cn.splice(o-2,1),c.cn.pop(),t.setDate(t.getDate()-7),n=l.createWeek(a.Z.clone(t)),c.cn.unshift(n.row),n.header&&c.cn.unshift(n.header);l.promiseVdomUpdate(l.vdom).then((()=>{Neo.main.DomAccess.scrollTo({direction:"top",id:l.vdom.cn[1].id,value:e.clientHeight-l.headerHeight})}))}l.isScrolling||(l.isScrolling=!0,r.Z.add(l.vdom.cn[1].cls,"neo-is-scrolling"),l.vdom.cn[0].cn[0].style.opacity=0,l.vdom=d),l.scrollTaskId&&clearTimeout(l.scrollTaskId),l.scrollTaskId=setTimeout(l.onWheelEnd.bind(l),300)}}onWheelEnd(){let e,t,o=this,n=o.vdom,a=n.cn[0].cn[0],l=6;for(o.isScrolling=!1;l<12;l++)if(t=n.cn[1].cn[l].flag,t){e=new Date(t),e.setMonth(e.getMonth()+1),a.cn[0].html=o.intlFormat_month.format(e),a.cn[1].html=` ${e.getFullYear()}`;break}r.Z.remove(n.cn[1].cls,"neo-is-scrolling"),a.style.opacity=1,o.vdom=n}updateEvents(){this.createContent()}updateHeader(e=!1){let t,o,n=this,a=n.currentDate,r=n.vdom,l=r.cn[0].cn[0],d=1;for(l.cn[0].html=n.intlFormat_month.format(a),l.cn[1].html=` ${a.getFullYear()}`,a.setDate(n.currentDate.getDate()-n.currentDate.getDay()+n.weekStartDay);d<8;d++)t=a.getDay(),e?(o={cls:["neo-day-name"],html:n.intlFormat_day.format(a)},n.showWeekends||0!==t&&6!==t||(o.removeDom=!0),r.cn[0].cn.push(o)):(o=r.cn[0].cn[d],o.html=n.intlFormat_day.format(a),n.showWeekends||0!==t&&6!==t?delete o.removeDom:o.removeDom=!0),a.setDate(a.getDate()+1);n.vdom=r}updateMonthNames(e=!1){let t=this,o=t.currentDate,n=t.vdom;l.Z.getFlags(n,"month-name").forEach((e=>{e.html=t.intlFormat_month.format(o),o.setMonth(o.getMonth()+1)})),t[e?"_vdom":"vdom"]=n}}Neo.applyClassConfig(c)}}]);