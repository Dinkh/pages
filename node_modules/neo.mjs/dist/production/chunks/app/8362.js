"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[8362,957],{8362:(e,t,r)=>{r.r(t),r.d(t,{default:()=>g});var a=r(402),o=r(9892),n=r(9671),s=r(957),i=r(5328),d=r(6500);class l extends s.default{static getConfig(){return{className:"Neo.calendar.view.week.EventDragZone",addDragProxyCls:!1,enableResizingAcrossOppositeEdge:!0,axisEndTime:0,axisStartTime:0,columnHeight:0,columnTop:0,currentInterval:0,eventDuration:0,eventRecord:null,forceUpdate:!1,hasOverflow:!1,intervalSize:15,keepEndDate:!1,keepStartDate:!1,moveHorizontal:!1,moveInMainThread:!1,newEndDate:null,newStartDate:null,scrollFactorLeft:3,useProxyWrapper:!1}}addBodyCursorCls(){Neo.applyDeltas(this.appName,{id:"document.body",cls:{add:["neo-cursor-move"]}})}adjustEndDate(e){return 0===e.getHours()&&0===e.getMinutes()?e.setMinutes(e.getMinutes()-1):23===e.getHours()&&59===e.getMinutes()||e.getMinutes()%this.intervalSize==0||e.setMinutes(e.getMinutes()+1),e}afterSetProxyParentId(e,t){if(e&&void 0!==t){let t=this;t.dragProxy?.vdom.cn[0].id&&Neo.applyDeltas(t.appName,{action:"moveNode",id:t.dragProxy.id,index:0,parentId:e})}}createDragProxy(e){let t=this,r=Neo.getComponent(t.getDragElementRoot().id)||t.owner,a=t.dragProxyConfig?.vdom,o=d.Z.clone(a||t.dragElement);o.cn[2].removeDom=!1;const s={module:n.Z,appName:t.appName,moveInMainThread:t.moveInMainThread,parentId:t.proxyParentId,...t.dragProxyConfig,vdom:t.useProxyWrapper?{cn:[o]}:o};s.cls=s.cls||[],s.cls.push("neo-focus"),r&&s.cls.push(r.getTheme()),o.cls&&!t.useProxyWrapper&&s.cls.push(...o.cls),t.addDragProxyCls&&i.Z.add(s.cls,t.dragProxyCls),Object.assign(s.style,{height:`${e.height}px`,top:e.y-t.columnTop+"px",width:`${e.width}px`}),t.dragProxy=Neo.create(s)}dragEnd(e){super.dragEnd(e);let t,r,a=this,n=a.owner,s=a.eventRecord;a.keepStartDate?(t=a.newEndDate,r=a.newStartDate||s.startDate):(r=new Date(d.Z.findVdomChild(n.vdom,a.proxyParentId).vdom.flag+"T00:00:00"),r.setHours(a.axisStartTime),r.setMinutes(a.currentInterval*a.intervalSize),a.keepEndDate?(t=a.newEndDate||s.endDate,r=a.newStartDate||r):(t=o.Z.clone(r),t.setMinutes(t.getMinutes()+a.eventDuration))),t=a.adjustEndDate(t),s.setSilent({endDate:t,startDate:r}),Object.assign(a,{currentInterval:0,hasOverflow:!1,keepEndDate:!1,keepStartDate:!1,newEndDate:null,newStartDate:null,proxyParentId:null}),n.getModel().getStore("events").doSort(),n.updateEvents()}dragMove(e){let t,r,a,n,s,i,d,l,g,c,p,u,m,v,D=this,h=D.axisEndTime,f=D.axisStartTime,y=D.columnHeight,x=D.eventDuration,E=0,C=D.intervalSize,M=D.keepEndDate,P=D.keepStartDate,w=e.targetPath,N=w.length,T=D.owner,S=D.eventRecord,I=!1,R=T.timeAxis;if(D.dragProxy){if(!M&&!P)for(;E<N;E++)if(w[E].cls.includes("neo-c-w-column")){D.proxyParentId=w[E].id;break}if(g=60*(h-f)/C,l=y/g,u=Math.min(y,e.clientY-D.offsetY-D.columnTop),r=Math.floor(u/l),s=o.Z.clone(S.endDate),m=o.Z.clone(S.startDate),M&&f>m.getHours()&&(m.setHours(f),m.setMinutes(0),x=(s-m)/60/1e3),P&&h<s.getHours()&&(s.setHours(h),s.setMinutes(0),x=(s-m)/60/1e3),M||(r=Math.min(r,g-x/C)),a=[{id:D.dragProxy.id,style:{}}],M||P)if(t=o.Z.clone(S.startDate),t.setHours(f),t.setMinutes(0),p=T.minimumEventDuration/C,v=(S.startDate-t)/C/60/1e3,M){if(c=v+x/C,D.enableResizingAcrossOppositeEdge){if(D.forceUpdate&&r>c-p&&r<c+p)return;r>=c+p?(I=!0,D.forceUpdate=!0,s.setHours(f),s.setMinutes(r*C),s=D.adjustEndDate(s),D.newEndDate=s,m.setHours(f),m.setMinutes(c*C),D.newStartDate=m,n=(s-m)/60/60/1e3,a[0].style.top=`calc(${c*l/y*100}% + 1px)`):(D.forceUpdate=!1,D.newStartDate=null)}I||(r=Math.min(r,c-p))}else if(P){if(c=v-x/C,D.enableResizingAcrossOppositeEdge)if(r=Math.max(-x/C,r),r<=c-p)I=!0,D.forceUpdate=!0,s.setHours(f),s.setMinutes(x+c*C),s=D.adjustEndDate(s),D.newEndDate=s,m.setHours(f),m.setMinutes(x+r*C),D.newStartDate=m,n=(s-m)/60/60/1e3,u=(x/C+r)*l,u=u/y*100,a[0].style.top=`calc(${u}% + 1px)`;else{if(D.forceUpdate&&r<c+p)return;D.forceUpdate&&r>=c+p&&D.currentInterval!==r&&(D.forceUpdate=!1,D.newStartDate=null,a[0].style.top=`calc(${v*l/y*100}% + 1px)`)}I||(r=Math.max(r,c+p))}P||(r=Math.max(0,r)),D.currentInterval!==r&&(I||(M||(s.setHours(f),s.setMinutes(x+r*C)),P?(D.newEndDate=s,n=(s-S.startDate)/60/60/1e3):(m.setHours(f),m.setMinutes(r*C),u=r*l,u=u/y*100,a[0].style.top=`calc(${u}% + 1px)`),M&&(n=(S.endDate-m)/60/60/1e3)),s=D.adjustEndDate(s),a.push({id:D.dragProxy.vdom.cn[2].id,innerHTML:T.intlFormat_time.format(s)}),(M||P)&&(d=Math.round(n/(h-f)*100*1e3)/1e3,a[0].style.height=`calc(${d}% - 2px)`),a.push({id:D.dragProxy.vdom.cn[0].id,innerHTML:T.intlFormat_time.format(m)}),D.dragProxy.vdom.cn[0].id&&(i=(n&&60*n||x)/R.interval,i<=2?R.rowHeight/i<25&&!D.hasOverflow&&(a.push({id:D.dragProxy.id,cls:{add:["neo-overflow"]}}),D.hasOverflow=!0):D.hasOverflow&&(a.push({id:D.dragProxy.id,cls:{remove:["neo-overflow"]}}),D.hasOverflow=!1),Neo.applyDeltas(D.appName,a))),D.currentInterval=r}}dragStart(e){let t,r,a,o=this;o.owner.getDomRect([o.getDragElementRoot().id,e.path[1].id]).then((n=>{t=(o.eventRecord.endDate-o.eventRecord.startDate)/60/1e3,r=e.clientX-n[0].left,a=e.clientY-n[0].top,Object.assign(o,{columnHeight:n[1].height,columnTop:n[1].top,dragElementRect:n[0],eventDuration:Math.round(t/o.intervalSize)*o.intervalSize,offsetX:r,offsetY:a}),o.createDragProxy(n[0]),o.fire("dragStart",{dragElementRect:n[0],id:o.id,offsetX:r,offsetY:a}),o.dragMove(e)}))}removeBodyCursorCls(){Neo.applyDeltas(this.appName,{id:"document.body",cls:{remove:["neo-cursor-move"]}})}}Neo.applyClassConfig(l);class g extends a.Z{static getConfig(){return{className:"Neo.calendar.view.week.plugin.DragDrop",isDragging:!1}}construct(e){super.construct(e);let t=this,r={scope:t,delegate:".neo-c-w-column"},a={scope:t,delegate:".neo-event"},o=t.owner,n=o.domListeners;n.push({"drag:end":t.onColumnDragEnd,...r},{"drag:end":t.onEventDragEnd,...a},{"drag:move":t.onColumnDragMove,...r},{"drag:move":t.onEventDragMove,...a},{"drag:start":t.onColumnDragStart,...r},{"drag:start":t.onEventDragStart,...a}),o.domListeners=n}adjustResizeEvent(e){return e.path.shift(),e.targetPath.shift(),e.target=e.path[0],e}getEventDragZone(e){let t=this.owner,r=t.eventDragZone,a=t.timeAxis,o={axisEndTime:a.getTime(t.endTime),axisStartTime:a.getTime(t.startTime),dragElement:e.dragElement,enableResizingAcrossOppositeEdge:e.enableResizingAcrossOppositeEdge,eventRecord:e.eventRecord,proxyParentId:e.proxyParentId};return r?r.set(o):t.eventDragZone=r=Neo.create({module:l,appName:this.appName,owner:t,scrollContainerId:t.getScrollContainer().id,...o,dragProxyConfig:{style:{transition:"none",willChange:"height"}}}),r}isTopLevelColumn(e){return e[0].cls.includes("neo-c-w-column")}isTopLevelEvent(e){return e.path[0].cls.includes("neo-event")}onColumnDragEnd(e){let t=this,r=t.owner,a=Symbol.for("addedRecord"),o=t[a];o&&t.isTopLevelColumn(e.path)&&(t.isDragging=!1,delete t[a],Neo.applyDeltas(t.appName,{id:r.getEventId(o.id),style:{opacity:1}}).then((()=>{r.eventDragZone.dragEnd(),r.getPlugin({flag:"resizable"}).onDragEnd(e)})))}onColumnDragMove(e){this.isTopLevelColumn(e.path)&&this.owner.eventDragZone?.dragMove(e)}onColumnDragStart(e){let t=this;if(t.isTopLevelColumn(e.targetPath)){let r,a,n,s,i,l=t.owner,g=l.timeAxis.getTime(l.startTime),c=l.calendarStore,p=e.path[0].rect,u=15,m=60*(l.timeAxis.getTime(l.endTime)-g)/u,v=p.height/m,D=Math.min(p.height,e.clientY-p.top),h=Math.floor(D/v),f=new Date(d.Z.findVdomChild(l.vdom,e.path[0].id).vdom.flag+"T00:00:00");t.isDragging=!0,f.setHours(g),f.setMinutes(Math.min(h*u,m*u-l.minimumEventDuration)),a=o.Z.clone(f),a.setMinutes(a.getMinutes()+l.minimumEventDuration),0===a.getHours()&&0===a.getMinutes()&&a.setMinutes(a.getMinutes()-1),i=l.eventStore.add({calendarId:l.data.activeCalendarId||c.getAt(0)[c.keyProperty],endDate:a,startDate:f,title:"New Event"})[0],t[Symbol.for("addedRecord")]=i,setTimeout((()=>{s=l.getEventId(i.id),r=d.Z.findVdomChild(l.vdom,s).vdom,n=t.getEventDragZone({dragElement:r,enableResizingAcrossOppositeEdge:!0,eventRecord:i,proxyParentId:e.path[0].id}),l.getPlugin({flag:"resizable"}).onDragStart(e),n.dragStart(e),setTimeout((()=>{t.isDragging&&Neo.applyDeltas(t.appName,{id:s,style:{opacity:0}})}),50)}),50)}}onEventDragEnd(e){let t=this,r=t.owner;r.enableDrag&&(r.eventDragZone.dragEnd(),t.isTopLevelEvent(e)?r.eventDragZone.removeBodyCursorCls():(e=t.adjustResizeEvent(e),r.getPlugin({flag:"resizable"}).onDragEnd(e)),t.isDragging=!1)}onEventDragMove(e){let t=this,r=t.owner;r.enableDrag&&(t.isTopLevelEvent(e)||(e=t.adjustResizeEvent(e)),r.eventDragZone.dragMove(e))}onEventDragStart(e){let t=this,r=t.owner,a=r.data;if(r.enableDrag){let o,n,s=t.isTopLevelEvent(e);s||(e=t.adjustResizeEvent(e)),t.isDragging=!0,o=d.Z.findVdomChild(r.vdom,e.path[0].id).vdom,n=t.getEventDragZone({dragElement:o,enableResizingAcrossOppositeEdge:a.events.enableResizingAcrossOppositeEdge,eventRecord:r.eventStore.get(o.flag),proxyParentId:e.path[1].id}),s?n.addBodyCursorCls():r.getPlugin({flag:"resizable"}).onDragStart(e),n.dragStart(e)}}}Neo.applyClassConfig(g)},9671:(e,t,r)=>{r.d(t,{Z:()=>o});var a=r(4022);class o extends a.Z{static getConfig(){return{className:"Neo.draggable.DragProxyComponent",ntype:"dragproxy",autoMount:!0,autoRender:!0,cls:["neo-dragproxy"],moveInMainThread:!0}}construct(e){super.construct(e);let t=this;t.on("mounted",t.onMounted,t)}onMounted(e){this.moveInMainThread&&Neo.main.addon.DragDrop.setDragProxyElement({appName:this.appName,id:e})}}Neo.applyClassConfig(o)},957:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});var a=r(9375),o=r(9671),n=r(5328),s=(r(2544),r(6500));class i extends a.Z{static getStaticConfig(){return{observable:!0}}static getConfig(){return{className:"Neo.draggable.DragZone",ntype:"dragzone",addDragProxyCls:!0,alwaysFireDragMove:!1,appName_:null,bodyCursorStyle:null,boundaryContainerId:null,data:null,dragElement:null,dragElementRect:null,dragProxy:null,dragProxyConfig_:null,dragProxyCls:"neo-dragproxy",dropZoneIdentifier:null,moveHorizontal:!0,moveInMainThread:!0,moveVertical:!0,offsetX:0,offsetY:0,owner:null,proxyParentId_:"document.body",scrollContainerId:null,scrollFactorLeft:1,scrollFactorTop:1,useProxyWrapper:!0}}construct(e){super.construct(e),Neo.main.addon.DragDrop||console.error("You can not use Neo.draggable.DragZone without adding Neo.main.addon.DragDrop to the main thread addons",this.id)}afterSetAppName(e,t){e&&Neo.currentWorker.insertThemeFiles(e,this.__proto__)}beforeGetDragProxyConfig(e){return Neo.clone(e,!0,!0)}createDragProxy(e){let t=this,r=Neo.getComponent(t.getDragElementRoot().id)||t.owner,a=t.dragElementRect,i=t.dragProxyConfig?.vdom,d=s.Z.clone(i||t.dragElement);const l={module:o.Z,appName:t.appName,moveInMainThread:t.moveInMainThread,parentId:t.proxyParentId,...t.dragProxyConfig,vdom:t.useProxyWrapper?{cn:[d]}:d};l.cls=l.cls||[],r&&l.cls.push(r.getTheme()),d.cls&&!t.useProxyWrapper&&l.cls.push(...d.cls),t.addDragProxyCls&&l.cls&&n.Z.add(l.cls,t.dragProxyCls),l.style=l.style||{},Object.assign(l.style,{height:`${e.height}px`,left:`${t.moveHorizontal?e.x:a.x}px`,top:`${t.moveVertical?e.y:a.y}px`,width:`${e.width}px`}),t.dragProxy=Neo.create(l)}destroyDragProxy(){let e=this,t=e.dragProxy.id;setTimeout((()=>{Neo.currentWorker.promiseMessage("main",{action:"updateDom",appName:e.appName,deltas:[{action:"removeNode",id:t}]})}),e.moveInMainThread?0:30),e.dragProxy.destroy()}dragEnd(e){let t=this,r=t.owner,a=r.cls;n.Z.remove(a,"neo-is-dragging"),r.cls=a,t.dragProxy&&(t.destroyDragProxy(),t.dragProxy=null),Object.assign(t,{dragElementRect:null,offsetX:0,offsetY:0,scrollContainerId:null}),t.fire("dragEnd",e),t.resetData()}dragMove(e){let t,r=this;!r.moveInMainThread&&r.dragProxy&&(t=r.dragProxy.style,r.moveHorizontal&&(t.left=e.clientX-r.offsetX+"px"),r.moveVertical&&(t.top=e.clientY-r.offsetY+"px"),r.dragProxy.style=t),r.fire("dragMove",e)}dragStart(e){let t,r,a=this,o=a.owner,s=o.cls,i=a.getDragElementRect(e);a.setData(),Neo.main.addon.DragDrop.setConfigs({appName:a.appName,...a.getMainThreadConfigs()}),n.Z.add(s,"neo-is-dragging"),o.cls=s,t=e.clientX-i.left,r=e.clientY-i.top,Object.assign(a,{dragElementRect:i,offsetX:t,offsetY:r}),a.createDragProxy(i),a.fire("dragStart",{clientX:e.clientX,clientY:e.clientY,dragElementRect:i,eventData:e,id:a.id,offsetX:t,offsetY:r})}getDragElementRect(e){let t=this.getDragElementRoot().id;for(let r of e.path)if(r.id===t)return r.rect;for(let r of e.targetPath)if(r.id===t)return r.rect;return null}getDragElementRoot(){return this.dragElement}getMainThreadConfigs(){let e=this;return{alwaysFireDragMove:e.alwaysFireDragMove,bodyCursorStyle:e.bodyCursorStyle,boundaryContainerId:e.boundaryContainerId,dragElementRootId:e.getDragElementRoot().id,dragProxyCls:e.dragProxyCls,dragZoneId:e.id,dropZoneIdentifier:e.dropZoneIdentifier,moveHorizontal:e.moveHorizontal,moveVertical:e.moveVertical,scrollContainerId:e.scrollContainerId,scrollFactorLeft:e.scrollFactorLeft,scrollFactorTop:e.scrollFactorTop}}onDrop(e){this.fire("drop",e)}onDropEnter(e){this.fire("drop:enter",e)}onDropLeave(e){this.fire("drop:leave",e)}resetData(){setTimeout((()=>{this.data=null}),30)}setData(e={}){let t=this;t.data={dragElement:t.getDragElementRoot(),dragZoneId:t.id,...e}}}Neo.applyClassConfig(i)},402:(e,t,r)=>{r.d(t,{Z:()=>o});var a=r(9375);class o extends a.Z{static getConfig(){return{className:"Neo.plugin.Base",ntype:"plugin",owner:null}}construct(e){super.construct(e);let t=this;t.owner.on("mounted",t.onOwnerMounted,t)}onOwnerMounted(){}}Neo.applyClassConfig(o)}}]);